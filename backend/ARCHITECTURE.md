# LocalFix Backend Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Frontend                            â”‚
â”‚                 (http://localhost:5173)                      â”‚
â”‚                                                              â”‚
â”‚  - UI Components                                            â”‚
â”‚  - State Management                                         â”‚
â”‚  - Routing                                                  â”‚
â”‚  - Animations                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTP Requests (JSON)
                       â”‚ Authorization: Bearer <JWT>
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Express.js Backend                          â”‚
â”‚                 (http://localhost:5000)                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              CORS Middleware                        â”‚    â”‚
â”‚  â”‚  Origin: http://localhost:5173                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Routes Layer                           â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  /api/auth/*     (Public)                         â”‚    â”‚
â”‚  â”‚  /api/users/*    (Protected - User)               â”‚    â”‚
â”‚  â”‚  /api/providers/* (Protected - Provider)          â”‚    â”‚
â”‚  â”‚  /api/admin/*    (Protected - Admin)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Middleware Layer                          â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  1. JWT Verification (auth.middleware.js)         â”‚    â”‚
â”‚  â”‚  2. Role Check (role.middleware.js)               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Controllers Layer                         â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  - auth.controller.js                             â”‚    â”‚
â”‚  â”‚  - user.controller.js                             â”‚    â”‚
â”‚  â”‚  - provider.controller.js                         â”‚    â”‚
â”‚  â”‚  - admin.controller.js                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Models Layer                           â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  - User.js (Mongoose Schema)                      â”‚    â”‚
â”‚  â”‚  - Provider.js (Mongoose Schema)                  â”‚    â”‚
â”‚  â”‚  - Admin.js (Mongoose Schema)                     â”‚    â”‚
â”‚  â”‚  - Booking.js (Mongoose Schema)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Error Handling                            â”‚    â”‚
â”‚  â”‚  (error.middleware.js)                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Mongoose ODM
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MongoDB Database                          â”‚
â”‚                 (mongodb://127.0.0.1:27017)                 â”‚
â”‚                                                              â”‚
â”‚  Collections:                                               â”‚
â”‚  - users                                                    â”‚
â”‚  - providers                                                â”‚
â”‚  - admins                                                   â”‚
â”‚  - bookings                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Request Flow

### Public Request (Login/Register)

```
Frontend â†’ POST /api/auth/login
         â†“
    Express Router
         â†“
    auth.controller.js
         â†“
    Find user in DB
         â†“
    Verify password (bcrypt)
         â†“
    Generate JWT token
         â†“
    Return { success, token, user }
         â†“
    Frontend stores token
```

### Protected Request (Get Profile)

```
Frontend â†’ GET /api/users/profile
         â†“ (with Authorization: Bearer <token>)
    Express Router
         â†“
    auth.middleware.js (verify JWT)
         â†“
    role.middleware.js (check role = 'user')
         â†“
    user.controller.js
         â†“
    Query MongoDB
         â†“
    Return user data
         â†“
    Frontend displays profile
```

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. POST /api/auth/register
     â”‚    { name, email, password }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend    â”‚
â”‚              â”‚
â”‚ - Hash pwd   â”‚
â”‚ - Save user  â”‚
â”‚ - Gen token  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Return { token, user }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â”‚          â”‚
â”‚ Store:   â”‚
â”‚ - token  â”‚
â”‚ - user   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Subsequent requests
     â”‚    Authorization: Bearer <token>
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend    â”‚
â”‚              â”‚
â”‚ - Verify JWT â”‚
â”‚ - Check role â”‚
â”‚ - Process    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Return data
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       User          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId       â”‚
â”‚ name: String        â”‚
â”‚ email: String       â”‚
â”‚ password: String    â”‚ (hashed)
â”‚ role: "user"        â”‚
â”‚ createdAt: Date     â”‚
â”‚ updatedAt: Date     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Provider        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId       â”‚
â”‚ name: String        â”‚
â”‚ email: String       â”‚
â”‚ password: String    â”‚ (hashed)
â”‚ serviceCategory     â”‚
â”‚ availability        â”‚
â”‚ role: "provider"    â”‚
â”‚ createdAt: Date     â”‚
â”‚ updatedAt: Date     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Admin         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId       â”‚
â”‚ email: String       â”‚
â”‚ password: String    â”‚ (hashed)
â”‚ role: "admin"       â”‚
â”‚ createdAt: Date     â”‚
â”‚ updatedAt: Date     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Booking        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId       â”‚
â”‚ userId: ObjectId    â”‚ â†’ User
â”‚ providerId: ObjectIdâ”‚ â†’ Provider
â”‚ service: String     â”‚
â”‚ date: Date          â”‚
â”‚ status: String      â”‚
â”‚ createdAt: Date     â”‚
â”‚ updatedAt: Date     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›£ï¸ API Routes Map

```
/api
â”‚
â”œâ”€â”€ /auth (Public)
â”‚   â”œâ”€â”€ POST /register
â”‚   â””â”€â”€ POST /login
â”‚
â”œâ”€â”€ /users (Protected - User Role)
â”‚   â”œâ”€â”€ GET  /profile
â”‚   â””â”€â”€ PUT  /profile
â”‚
â”œâ”€â”€ /providers (Protected - Provider Role)
â”‚   â”œâ”€â”€ GET  /dashboard
â”‚   â””â”€â”€ PUT  /profile
â”‚
â””â”€â”€ /admin (Protected - Admin Role)
    â”œâ”€â”€ GET    /dashboard
    â”œâ”€â”€ GET    /users
    â””â”€â”€ DELETE /users/:id
```

## ğŸ”’ Security Layers

```
Request
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CORS Check     â”‚ â† Only allow localhost:5173
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT Verify     â”‚ â† Validate token signature
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Role Check     â”‚ â† Verify user has required role
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller     â”‚ â† Process business logic
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database       â”‚ â† Query/Update data
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response       â”‚ â† Return JSON
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ File Organization

```
backend/
â”‚
â”œâ”€â”€ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ config/          â† Configuration
â”‚   â”‚   â””â”€â”€ db.js        (MongoDB connection)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/          â† Data schemas
â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”‚   â”œâ”€â”€ Provider.js
â”‚   â”‚   â”œâ”€â”€ Admin.js
â”‚   â”‚   â””â”€â”€ Booking.js
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/     â† Business logic
â”‚   â”‚   â”œâ”€â”€ auth.controller.js
â”‚   â”‚   â”œâ”€â”€ user.controller.js
â”‚   â”‚   â”œâ”€â”€ provider.controller.js
â”‚   â”‚   â””â”€â”€ admin.controller.js
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/          â† API endpoints
â”‚   â”‚   â”œâ”€â”€ auth.routes.js
â”‚   â”‚   â”œâ”€â”€ user.routes.js
â”‚   â”‚   â”œâ”€â”€ provider.routes.js
â”‚   â”‚   â””â”€â”€ admin.routes.js
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/      â† Request processing
â”‚   â”‚   â”œâ”€â”€ auth.middleware.js
â”‚   â”‚   â”œâ”€â”€ role.middleware.js
â”‚   â”‚   â””â”€â”€ error.middleware.js
â”‚   â”‚
â”‚   â””â”€â”€ server.js        â† Entry point
â”‚
â”œâ”€â”€ .env                 â† Environment variables
â”œâ”€â”€ package.json         â† Dependencies
â””â”€â”€ createAdmin.js       â† Utility script
```

## ğŸ¯ Data Flow Example

### User Registration

```
Frontend Form
    â†“
{ name: "John", email: "john@test.com", password: "pass123" }
    â†“
POST /api/auth/register
    â†“
auth.controller.js â†’ registerUser()
    â†“
Check if user exists
    â†“
Hash password with bcrypt
    â†“
Save to MongoDB (users collection)
    â†“
Generate JWT token
    â†“
Return { success: true, token, user }
    â†“
Frontend stores token & user
    â†“
Redirect to dashboard
```

### Protected API Call

```
Frontend needs user profile
    â†“
GET /api/users/profile
Headers: { Authorization: "Bearer eyJhbG..." }
    â†“
auth.middleware.js
    â†“
Extract token from header
    â†“
Verify JWT signature
    â†“
Decode payload â†’ { id, role }
    â†“
Attach to req.user
    â†“
role.middleware.js
    â†“
Check req.user.role === 'user'
    â†“
user.controller.js â†’ getUserProfile()
    â†“
Find user by req.user.id
    â†“
Return user data (exclude password)
    â†“
Frontend displays profile
```

## ğŸ”„ Error Handling Flow

```
Error occurs
    â†“
Try/catch in controller
    â†“
next(error)
    â†“
error.middleware.js
    â†“
Identify error type:
  - ValidationError
  - DuplicateKeyError
  - CastError
  - JWTError
  - Generic Error
    â†“
Format error response
    â†“
Return { success: false, message, errors }
    â†“
Frontend displays error
```

---

This architecture ensures:
- âœ… Clean separation of concerns
- âœ… Secure authentication
- âœ… Role-based access control
- âœ… Scalable structure
- âœ… Easy to maintain
- âœ… Production-ready
